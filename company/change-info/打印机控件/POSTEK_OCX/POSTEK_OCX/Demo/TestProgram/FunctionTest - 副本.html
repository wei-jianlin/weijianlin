
<html>
<head>
<script language="javascript">

window.onload=function(){  
  var obj=document.getElementById("PSKPrn");  
  //readyState为4时,代表完全加载了.  
  if(obj.readyState==4){  
     alert("加载成功!");  
  }else{  
     alert("加载失败!");  
  }  
}  
//这里可接收ocx的返回信息

function Print2DCode()
{
	OpenPrinter();
	
	PSKPrn.PTKDrawText (5,10,0,97,1,1,78,"DataMatrix");
	PSKPrn.PTKDrawBar2DDATAMATRIX(50, 50, 0, 0, 0, 5,"123456789");//DataMatrix码
	
	PSKPrn.PTKDrawText (180,10,0,97,1,1,78,"QR");
	PSKPrn.PTKDrawBar2DQR(150, 50, 180, 180, 0, 3, 2, 0,0, "123456789");//QR码
	
	PSKPrn.PTKDrawText (300,10,0,97,1,1,78,"PDF417");
	PSKPrn.PTKDrawBar2DPdf417(260,50,400,300,0,0,2,10,10,2,0,0,"123456789");//PDF417码
	
	PSKPrn.PTKDrawText (600,10,0,97,1,1,78,"MaxiCode");
	PSKPrn.PTKDrawBar2DMaxiCode(500,50,4,0,"1Z000A7&dajc_iaj-3=+~#^$5&#fe[{:'s;fk.,LAKFalkdgjoiu12815/w35::'./dfoi38&*^}!+");//MaxiCode条码
	
	PSKPrn.PTKDrawText (5,200,0,97,1,1,78,"汉信码二维条码,请确认打印有该功能");
	PSKPrn.PTKDrawBar2DHANXIN(50,300,0,0,0,5,1,3,2,"POSTEK");//汉信码二维条码
	

	PSKPrn.PTKPrintLabel(1, 1);
	ClosePrinter();

}

function generalTest()
{
	OpenPrinter();
	
	PSKPrn.PTKDrawLineOr(58,2,500,3);//上边框
	PSKPrn.PTKDrawLineOr(58,2,3,500);//左边框
	PSKPrn.PTKDrawLineOr(558,2,3,500);//右边框
	PSKPrn.PTKDrawLineOr(58,502,500,3);//底边框
	
	
	PSKPrn.PTKPcxGraphicsDel("*")
	PSKPrn.PTKDrawTextTrueTypeW(75, 20, 36, 0, "宋体", 1, 700, false, false, false, "A1", "TEST "); //打印TrueType字体
	PSKPrn.PTKDrawText (75,60,0,97,1,1,78,"内置软字体");//内置字体97,78 为a和N的ASCII值
	PSKPrn.PTKDrawBarcode(250, 20, 0, '1', 3, 3, 50, 66, "123456789");	//N的ASCII码是78，B的ASCII码是66
  PSKPrn.PTKDrawLineXor(58,100,500,3);	//打印直线，注意两线交集处的效果

	PSKPrn.PTKDrawBar2DQR(460, 144, 180, 180, 0, 3, 2, 0,0, "123456789");//QR码
	PSKPrn.PTKDrawDiagonal (460,238,8,520,288);//斜线
	PSKPrn.PTKDrawTextTrueTypeW(530, 100, 26, 0, "宋体", 2, 400, false, false, false, "A4", "网站：www.postek.com.cn"); //文字旋转
	
	PSKPrn.PTKDrawTextTrueTypeW(64, 138, 26, 0, "宋体", 1, 700, false, false, false, "A2", "产品名称：条码打印机");
	PSKPrn.PTKDrawTextTrueTypeW(64, 188, 26, 0, "宋体", 1, 400, false, false, false, "A3", "电话：0755-83240988");

	PSKPrn.PTKDrawTextTrueTypeW(64, 238, 26, 0, "宋体", 1, 400, false, false, false, "A5", "NY/T 18672-2012");
	PSKPrn.PTKDrawTextTrueTypeW(64, 288, 26, 0, "宋体", 1, 400, false, false, false, "A6", "日期:2010-09-15");
	PSKPrn.PTKDrawTextTrueTypeW(64, 338, 26, 0, "宋体", 1, 700, false, false, false, "A7", "地址：广东省深圳市南山区");
	PSKPrn.PTKDrawTextTrueTypeW(64, 388, 19, 0, "宋体", 1, 400, false, false, false, "A8", "请注意PTKDrawTextTrueTypeW函数ID_NAME--识别号");
	PSKPrn.PTKDrawBar2DPdf417(80,430,400,300,0,0,3,7,10,2,0,0,"123456789");//PDF417码
	
	PSKPrn.PTKPrintLabel(1, 1);
	ClosePrinter();

}	
function printVariableTest()
{
	OpenPrinter();
	
	PSKPrn.PTKFormDel("LSFORM");//删除存储在打印机里的名称为LSFORM表格	
	PSKPrn.PTKFormDownload("LSFORM");//存储一个名称为LSFORM的表格到打印机	
	PSKPrn.PTKDefineCounter(0,10,78,"+1","C0");//定义一个序列号变量C0	
	PSKPrn.PTKDefineCounter(1,10,78,"+2","C1");//定义一个序列号变量C1
	PSKPrn.PTKDefineVariable(0,16,78,"Variable");//定义变量字符串V0，命名为：'V'+第一个参数
	
	PSKPrn.PTKDrawBarcodeEx(100,100,0,"3",2,6,30,66,"\"EAN\"C0",true); //打印一个条码，最后一个参数表示打印变量，倒数第二个参数中包含变量		
	PSKPrn.PTKDrawTextEx(100,160,0,2,1,1,78,"\"条码内容为：\"C0",true);//打印一行文本文字(字符串中即有常量也有变量C0)	
	
	PSKPrn.PTKDrawTextEx(100,220,0,2,1,1,78,"\"打印序列号：\"C1",true);//打印一行文本文字(字符串中只有变量C1)	
	PSKPrn.PTKDrawTextEx(100,280,0,2,1,1,78,"\"打印变量：\"V0",true);//打印一行文本文字(字符串中只有变量C1)
	
	PSKPrn.PTKDrawTextEx(100,340,0,2,1,1,78,"\"组合功能：序号:\"C1\"变量:\"V0",true);//组合打印
	PSKPrn.PTKFormEnd(); //结束存储表格
	
	PSKPrn.PTKExecForm("LSFORM"); //运行指定的表格:LSFORM	
	PSKPrn.PTKDownload(); //下载变量或系列号变量
	//初始化顺序和定义变量或序列号顺序对应
        PSKPrn.PTKDownloadInitVar("12345678"); //初始化系列号变量C0
        PSKPrn.PTKDownloadInitVar("123456"); //初始化系列号变量C1
        PSKPrn.PTKDownloadInitVar("1111"); //初始化变量V0
  
        PSKPrn.PTKPrintLabel(3,1);//命令打印机执行打印工作
  
        ClosePrinter();
		
}	
function printPicTest()
{
	 var iDire;

	 var filename = document.getElementById("FileBrowse").value;
	 if(filename == "")
	 {
	 	alert("请点击浏览按钮选择在本地电脑要打印的图片");
	 	return; 
	 }
	 var exname=filename.substr(filename.lastIndexOf(".")+1).toUpperCase();   
	 //alert(filename.substr(filename.lastIndexOf(".")+1).toUpperCase());
   if(exname == "PCX" || exname == "BMP")
   {  // alert("找到PCX或BMP");
	    if(document.all['PrintPIC'][0].checked){
	    	//alert("pcxCHEKC");
	    	if(exname != "PCX")
	    	{
	    		alert("图片不是PCX文件，请重新选择一致类型");
	    		return;
	    	}
	      OpenPrinter();
	      PSKPrn.PTKPcxGraphicsDel("*");
   //  PSKPrn.PTKPcxGraphicsDownload("PCX","E:\\PcxTest.pcx");
        PSKPrn.PTKPcxGraphicsDownload("PCX",filename);
	      PSKPrn.PTKDrawPcxGraphics(100,200,"PCX");
      }
     else if(document.all['PrintPIC'][1].checked){
     	//alert("bmpCHEKC");
     		if(exname != "BMP")
	    	{
	    		alert("图片不是BMP文件，请重新选择一致类型");
	    		return;
	    	}
   	   OpenPrinter();
       PSKPrn.PTKPcxGraphicsDel("*");  
       if(document.all['Dire'][0].checked){
    	   iDire = 0;
       }
       else if(document.all['Dire'][1].checked){
    	   iDire = 1;
       }
       else if(document.all['Dire'][2].checked){
    	   iDire = 2;
       }
       else if(document.all['Dire'][3].checked){
    	   iDire = 3;
       }
       else{
       	 iDire = 0;
       	 //alert("默认方向是0");
      }
    //PSKPrn.PTKBmpGraphicsDownload("BMP","e:\\BmpTest.bmp" , iDire);
       PSKPrn.PTKBmpGraphicsDownload("BMP",filename,iDire);
	     PSKPrn.PTKDrawPcxGraphics(100,200,"BMP");
     }
    else 	{
  		alert("请选择要打印的图片类型");		
  		return;
  	}
	//PSKPrn.PTKPrintPCX(100,100,"E:\Test.pcx");
	  PSKPrn.PTKPrintLabel(1,1);
	  ClosePrinter();
  }
  else{
	alert("仅支持PCX和BMP,请确认您选择的图片是否正确，多谢！");
  		 		return;
  }

}	

function OpenPrinter()
{

  PSKPrn.OpenPort("POSTEK C168/200s");
	PSKPrn.PTKClearBuffer();
	PSKPrn.PTKSetPrintSpeed(4);
	PSKPrn.PTKSetDarkness(10);
	PSKPrn.PTKSetLabelHeight(600, 16,0,0);
	PSKPrn.PTKSetLabelWidth(832);
	
}
function ClosePrinter()
{
	PSKPrn.ClosePort();
}

function findFile() {
	OpenPrinter();
       //PSKPrn.PTKSoftFontList();
       PSKPrn.PTKFormList();
       PSKPrn.PTKPrintLabel(1,1);

       ClosePrinter();
      }

</script>
</head>
<body>
<object 
id="PSKPrn"
classid="clsid:81C07687-3353-4ABA-B108-94BCE81E5CBA"
codebase="C:\Windows\SysWOW64/PSKPrn.ocx#version=1.0"
width="0"
height="0"
>
</object>

<BODY>
<FORM name=form1 action="" method="post">
<TABLE height=30 cellSpacing=3 cellPadding=0 width="100%" border=0>
 <tr>
    <td align="left" height="80" class=title>&nbsp;</td>
    <td align="right" valign="bottom">
    	 <INPUT type=button value="普通打印测试" name=Button1 class="button1" onClick="javascript:generalTest()">
       <INPUT type=button value="变量打印测试" name=Button2 class="button2" onClick="javascript:printVariableTest()">
       <INPUT type=button value="打印二位条码" name=Button4 class="button4" onClick="javascript:Print2DCode()">
       <!-- <INPUT type=button value="打印二位条码" name=Button4 class="button4" onclick="alert(document.getElementById('FileBrowse').value)">-->
    </td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><table width="100%" border="0">
      <tr>
        <td width="10%" rowspan="5"></td>
        <td  align="right" valign="bottom">
         <font color = "#FF0000">以下是图形打印测试</font>
        </td>
      </tr>
       <tr>
        <td align="right" valign="bottom" bgcolor = "CCCCCCC">
        	<p><font color = "#FF0000">选择打印图片类型</font>
        	<input type="radio" value="0" name="PrintPIC">PrintPCX
        	<input type="radio" value="1" name="PrintPIC">PrintBmp	
        </td>
      </tr>
      <tr>
        <td align="right" valign="bottom">
        <INPUT id="FileBrowse" type="file" > 
        </td>
      </tr>
      <tr>
        <td align="right" valign="bottom">
        	<p><font color = "#FF0000">打印方向只对BMP图片有效，默认为0°</font>
        <input type="radio" value="0" name="Dire">旋转：0°
        <input type="radio" value="1" name="Dire">旋转：90°
        <input type="radio" value="2" name="Dire">旋转：180°
        <input type="radio" value="3" name="Dire">旋转：270°	
        </td>
      </tr>
      <tr>
        <td align="right" valign="bottom">
        	<INPUT type=button value="图片打印测试" name=Button3 class="button3" onClick="javascript:printPicTest()">  
        </td>
      </tr>
    </table>      
      <label></label></td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
 
  <TR align="center">
    <TD height=22 colSpan=6 bgColor=#DCEDDF>        
    </TD>
  </TR>
 </TR>
</TABLE>
</FORM>

</body>
</html>

